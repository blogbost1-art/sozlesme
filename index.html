<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AVIS — Kiralama Sözleşmesi Poliçesi</title>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <style>
    :root{--paper-width:800px;--paper-padding:48px}
    html,body{height:100%;margin:0;font-family:Arial, Helvetica, sans-serif;background:#f6f6f6;color:#222}
    .wrap{min-height:100%;display:flex;justify-content:center;padding:40px 20px}
    /* Document (white page) */
    .document{width:var(--paper-width);background:#fff;padding:var(--paper-padding);box-shadow:0 8px 30px rgba(0,0,0,0.08);position:relative}

    /* Watermark */
    .watermark{position:absolute;left:50%;top:45%;transform:translate(-50%,-50%) rotate(-12deg);font-size:64px;color:#c40000;opacity:0.06;font-weight:800;letter-spacing:6px;pointer-events:none;user-select:none}

    .header{text-align:center;margin-bottom:18px}
    .logo{color:#c40000;font-weight:800;font-size:34px;letter-spacing:2px}
    .logo sup{font-size:14px;position:relative;top:-12px}
    .title{font-size:16px;margin:6px 0 0 0;font-weight:700}
    .subtitle{color:#666;font-size:12px;margin-top:4px}

    .content{margin-top:20px;font-size:13px;line-height:1.4;text-align:justify}
    .content p{margin:10px 0}

    .fields{margin-top:22px;display:flex;gap:16px}
    .field{flex:1}
    label{display:block;font-weight:700;font-size:13px;margin-bottom:6px}
    input[type=text],input[type=date]{width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;font-size:13px}

    .signature-block{margin-top:20px}
    .sig-label{font-weight:700;margin-bottom:8px}
    .sig-canvas{width:100%;height:120px;border:1px solid #ddd;border-radius:6px;background:#fafafa;touch-action:none}
    .sig-actions{display:flex;gap:10px;align-items:center;margin-top:8px}
    .no-export{ /* elements with this class will not be exported into PDF */ }

    .footer-line{border-top:1px solid #eee;margin-top:24px;padding-top:12px;font-size:12px;color:#666}

    .buttons{display:flex;justify-content:center;gap:12px;margin-top:20px}
    button{background:#c40000;color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:700}
    button.secondary{background:#555}

    /* Small screens */
    @media (max-width:840px){:root{--paper-width:680px}}
    @media print{body{background:#fff} .wrap{padding:0} .no-export{display:none} .document{box-shadow:none}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="document" id="document-root">

      <!-- Watermark behind content -->
      <div class="watermark">AVIS SÖZLEŞME POLİÇESİ</div>

      <div class="header">
        <div class="logo">AVIS<sup>®</sup></div>
        <div class="title">KİRALAMA SÖZLEŞMESİ POLİÇESİ</div>
        <div class="subtitle">Resmî Belge — Lütfen eksiksiz doldurunuz</div>
      </div>

      <div id="content-area" class="content">
        <p><strong>1-)</strong> Araçlarda HGS olup (Hızlı Geçiş Sistemi), kiracı kira dönüşü geçiş yaptığı bedel online olarak kontrol edilip araç teslim ettiğinde anlık provizyon ücretinden düşülecektir.</p>
        <p><strong>2-)</strong> Kiralanan aracın her ne şekilde ve şartta olursa olsun kiraya verilmesi, bedelsiz de olsa üçüncü şahıslara kullandırılması yasak olup, aracın:<br>
        a) Ek sürücü olarak belirtilmeyen sürücü tarafından aracın kullanılması.<br>
        b) Herhangi bir vasıtayı çekmek veya itmek.<br>
        c) Gelir karşılığı yolcu veya mal taşımasında.<br>
        d) Türkiye Cumhuriyeti sınırları dışında kullanılmasında.</p>

        <p><strong>3-)</strong> Aracın sürücüsü alkol, uyuşturucu, uyku hapları etkisinde olmadığı sürece, aracın zarar görmesi durumunda hasar sorumluluğunu itiraz etmeksizin karşılamayı firmamız olarak kabul ediyoruz.<br>
        a) Poliçe ödemeleri sizin hesaplarınızda kalacaktır. Kasko ve sigorta poliçesi 50.000 TL’dir. 15 dakika sonrasında ödemelerinizi kullanabilirsiniz. İşlemler 15 dakikalık bir süredir.<br>
        b) Kaza anında alkol, uyuşturucu veya uyku geciktirici ilaçlar etkisi altındaysanız; yasal hız sınırlarının aşıldığı durumlarda ve aracın zarar görmesi durumunda masraflar kiracıya aittir.<br>
        c) Sözleşmenin akdinden sonra kiracı herhangi bir nedenle araç kullanma yetkisini kaybederse (ehliyete el konulması durumunda) aracın konumunu atarak vale görevlimize teslim etmesi gerekir.<br>
        d) Araçla alkollü veya uyuşturucu etkisinde kaza yapmanız durumunda araç masrafı ve aracın minimum 120.000 TL pert (değer kaybı) bedeli sizlere aittir.<br>
        e) Kiracı ve kira sözleşmesinde ek sürücü olarak belirlenenlerin haricindeki şahısların aracı kullanması neticesinde meydana gelen hasar ve/veya kazalarda: Aracın çalınması veya zarar görmesi durumunda kasko ve sigorta firmaları araç masraflarını öder. Kazalarda yaralanmalı veya ölümlü durumlarda kasko ve sigorta firmaları sizlere ödeme yapmakla yükümlüdür.</p>

        <p><strong>4-)</strong> Kiracının kiralanan araç ile karıştığı herhangi bir kazada; kiracı alkol, uyuşturucu etkisinde olay yerini terk etmesi durumunda, doğrudan ve dolaylı zararlar kiracıdan talep edilecektir.</p>

        <p><strong>NOT:</strong> Görüşmelerimiz kayıt altına alınmaktadır. Sözleşmenin WhatsApp üzerinden atılması gereklidir. Sözleşme muhasebe departmanımız tarafından atılacaktır.<br>
        <strong>ŞARTLAR UYGUN OLDUĞU TAKDİRDE, WHATSAPP ÜZERİNDEN “OKUDUM, KABUL EDİYORUM” YAZMANIZ GEREKLİDİR.</strong></p>

        <div class="fields">
          <div class="field">
            <label>Ad Soyad</label>
            <input id="fullname" type="text" placeholder="Ad Soyad">
          </div>
          <div class="field">
            <label>Tarih</label>
            <input id="date" type="date">
          </div>
        </div>

        <div class="signature-block">
          <div class="sig-label">İmza (Aşağıya fare veya dokunmatik ile çiziniz)</div>
          <canvas id="sigCanvas" class="sig-canvas"></canvas>
          <div class="sig-actions no-export">
            <button id="clearBtn" type="button">İmzayı Temizle</button>
            <button id="cancelBtn" class="secondary no-export" type="button">İptal</button>
          </div>
        </div>

        <div class="footer-line">Bu belge taraflar arasında yapılmış resmi bir sözleşmedir.</div>
      </div>

      <div class="buttons no-export">
        <button id="downloadBtn">PDF Olarak İndir</button>
        <button id="previewBtn">PDF Önizleme</button>
      </div>

    </div>
  </div>

  <!-- Kütüphaneler -->
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    // Signature Pad setup
    const canvas = document.getElementById('sigCanvas');
    const signaturePad = new SignaturePad(canvas, { backgroundColor: 'rgba(0,0,0,0)' });

    function resizeSigCanvas(){
      const ratio = Math.max(window.devicePixelRatio || 1, 1);
      const w = canvas.offsetWidth;
      canvas.width = Math.floor(w * ratio);
      canvas.height = Math.floor(120 * ratio);
      const ctx = canvas.getContext('2d');
      ctx.scale(ratio, ratio);
      signaturePad.clear();
    }
    window.addEventListener('resize', resizeSigCanvas);
    resizeSigCanvas();

    document.getElementById('clearBtn').addEventListener('click', ()=> signaturePad.clear());
    document.getElementById('cancelBtn').addEventListener('click', ()=>{
      signaturePad.clear(); document.getElementById('fullname').value=''; document.getElementById('date').value='';
    });

    // Helper — clone document and remove elements with .no-export before rendering to canvas
    async function renderCleanToCanvas(){
      const root = document.getElementById('document-root');
      const clone = root.cloneNode(true);
      // remove UI elements not for export
      clone.querySelectorAll('.no-export').forEach(n=>n.remove());
      // if watermark is present it's fine
      // append clone to body hidden
      clone.style.position='fixed'; clone.style.left='50%'; clone.style.top='50%'; clone.style.transform='translate(-50%,-50%)';
      clone.style.boxShadow='none'; clone.style.background='#fff'; clone.style.zIndex=9999;
      document.body.appendChild(clone);
      // ensure any inputs in clone show user values
      const fullname = document.getElementById('fullname').value;
      const date = document.getElementById('date').value;
      const cloneFull = clone.querySelector('#fullname'); if(cloneFull) cloneFull.replaceWith(createTextNode(fullname || '-'));
      const cloneDate = clone.querySelector('#date'); if(cloneDate) cloneDate.replaceWith(createTextNode(date || '-'));

      // remove interactive canvas inside clone (we'll add small signature ourselves)
      const cloneCanvas = clone.querySelector('#sigCanvas'); if(cloneCanvas) cloneCanvas.remove();

      // render
      const canvasRendered = await html2canvas(clone, { scale: 2, useCORS: true, backgroundColor: '#ffffff' });
      document.body.removeChild(clone);
      return { canvas: canvasRendered, width: clone.offsetWidth };
    }

    function createTextNode(text){ const div = document.createElement('div'); div.textContent = text || '-'; div.style.fontSize='13px'; div.style.padding='6px 0'; return div; }

    async function generatePdf(openPreview = false){
      if(!document.getElementById('fullname').value){ if(!confirm('Ad Soyad boş. Yine de devam etmek istiyor musunuz?')) return; }

      const sigEmpty = signaturePad.isEmpty();
      const sigData = sigEmpty ? null : signaturePad.toDataURL('image/png');

      const rendered = await renderCleanToCanvas();
      const canvasRendered = rendered.canvas;
      const imgData = canvasRendered.toDataURL('image/png');

      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF('p','pt','a4');
      const pageWidth = pdf.internal.pageSize.getWidth();
      const pageHeight = pdf.internal.pageSize.getHeight();

      // fit the rendered image into PDF page with small margins
      const margin = 40; // pts
      const availableW = pageWidth - margin*2;
      const imgW = availableW;
      const imgH = (canvasRendered.height * imgW) / canvasRendered.width;
      pdf.addImage(imgData,'PNG',margin,margin,imgW,imgH);

      // add name & small signature near bottom (after the rendered content)
      const name = document.getElementById('fullname').value || '-';
      const yForName = margin + imgH + 20;
      pdf.setFontSize(12);
      pdf.text(`Ad Soyad: ${name}`, margin, yForName);
      pdf.text(`Tarih: ${document.getElementById('date').value || '-'}`, margin + 300, yForName);

      if(sigData){
        // draw small signature to the right of the name
        const sigW = 120; const sigH = 50;
        pdf.addImage(sigData,'PNG', margin + 100, yForName - 18, sigW, sigH);
      }

      if(openPreview){ window.open(pdf.output('bloburl'), '_blank'); }
      else { pdf.save(`Kiralama_Sozlesme_${name.replace(/\s+/g,'_') || 'Isimsiz'}.pdf`); }
    }

    document.getElementById('downloadBtn').addEventListener('click', ()=> generatePdf(false));
    document.getElementById('previewBtn').addEventListener('click', ()=> generatePdf(true));
  </script>
</body>
</html>
